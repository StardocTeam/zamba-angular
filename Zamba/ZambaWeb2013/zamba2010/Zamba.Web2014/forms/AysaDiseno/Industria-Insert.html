<html>
<head>
    <title>Industria</title>
    <link href="Aysa_styles.css" type="text/css" rel="stylesheet"/>
    <link href="Aysa_styles_table.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="Scripts/Aysa.js"></script>

    <script type="text/javascript" language="JavaScript">
        function makeCalendar(id) {
            $(function() {
                $('#' + id).datepicker({
                    changeMonth: true,
                    changeYear: true,
                    showOn: 'both',
                    buttonText: 'Abrir calendario',
                    buttonImage: 'images/calendar.png',
                    buttonImageOnly: true,
                    duration: "",
                    maxDate: '+0d',
                    dateFormat: 'dd/mm/yy',
                    constrainInput: true
                });
            });
        }

        function MakeCalendarAfterValue(idSource, idDestiny) {
            var mindate = $("#" + idSource).val().split("/");
            $('#' + idDestiny).datepicker("option", "minDate", new Date(mindate[2], mindate[1] - 1, mindate[0]));
        }

        //Ezequiel: Funcion que selecciona automaticamente los valores relacionados en dos indices
        function AssociateIndexs(index1, index2) {
            $("#" + index1).change(
                    function() {
                        $("#" + index2 + " option").each(
                          function() {
                              if ($(this).val().trim() == $("#" + index1 + " option:selected").val().trim()) {
                                  $(this).attr("selected", "selected");
                              }
                          }
                       );
                        $("#" + index2).valid();
                    }
                );
        }

        //Función que evalua si habilitar o no un control en base a uno o dos valores
        function ConditionalEnable(ObjSource, ObjDestiny, Value, Value2) {
            if ($("#" + ObjSource).val() == Value || (Value2 != undefined && $("#" + ObjSource).val() == Value2)) {

                //Quita la clase que ignora el validate y valida el control nuevamente
                $("#" + ObjDestiny).removeClass("disable");
                $("#" + ObjDestiny).valid();
                //Habilita el datepicker
                $("#" + ObjDestiny).datepicker("enable");
                //Muestra el asterisco para marcar que es un campo requerido.
                $("#lbl_" + ObjDestiny).show();
                $("#" + ObjDestiny).attr('disabled', '');

//                if ($("#" + ObjDestiny).datepicker("option", "disabled") === undefined) {
//                    $("#" + ObjDestiny).attr('disabled', 'disabled');
//                }
            }
            else {
                $("#" + ObjDestiny).attr('disabled', 'disabled');
                $("#" + ObjDestiny).val("");
                if($("#" + ObjDestiny)[0].length > 1)
                {
					var i;
					for(i = 0; i < $("#" + ObjDestiny)[0].length;i++)
						if($("#" + ObjDestiny)[0][i].innerHTML == "A Definir")
							$("#" + ObjDestiny)[0][i].selected = true;
						else
							$("#" + ObjDestiny)[0][i].selected = false;
                }
                //$("#ObjDestiny").selectedIndex = -1;
                //Agrega la clase que ignora el validate y valida el control nuevamente
                $("#" + ObjDestiny).addClass("disable");
                $("#" + ObjDestiny).valid();
                //Oculta el asterisco para marcar que es un campo requerido.
                $("#lbl_" + ObjDestiny).hide();
                //deshabilita el datepicker
                $("#" + ObjDestiny).datepicker("disable");
                $("#" + ObjDestiny).change();
            }
        }

        //Crea las validaciones de los campos
        function makerequired() {
            $('#aspnetForm').validate(
				{
				    onsubmit: false,
				    ignore: ".disable",
				    rules: {
				        //Razon social
				        zamba_index_1188: {
				            required: true,
				            maxlength: 150
				        },
				        //CIC
				        zamba_index_1220: {
				            required: true
				        },
				        //Tipo de industria
				        zamba_index_1185: {
				            required: true,
				            digits: {//Se utiliza el tipo de validacion digits solo para aplicar si contiene o no un espacio.
				                depends: function(element) {
				                    return $(element).val() == " ";
				                }
				            }
				        },
				        //Fecha alta
				        zamba_index_1214: {
				            maxlength: 10,
				            date: true
				        },
				        //Fecha baja
				        zamba_index_1215: {
				            maxlength: 10,
				            date: true
				        },//Tipo de actividad
				        zamba_index_1189: {
				            required: true,
				            digits: {//Se utiliza el tipo de validacion digits solo para aplicar si contiene o no un espacio.
				                depends: function(element) {
				                    return $(element).val() == " " && $("#zamba_index_1220").val() != "00";
				                }
				            }
				        },
				        //Cod.Tipo de actividad
				        zamba_index_1223: {
				            required: true,
				            digits: {//Se utiliza el tipo de validacion digits solo para aplicar si contiene o no un espacio.
				                depends: function(element) {
				                    return $(element).val() == " " && $("#zamba_index_1220").val() != "00";
				                }
				            }
				        },
				        //CIC
				        zamba_index_1220: {
				            required: true,
				            maxlength: 10,
				            digits: {
				                depends: function(element) {
				                    return $(element).val() == " ";
				                }
				            }
				        }
				    },
				    messages: {
				        //Tipo de industria
				        zamba_index_1185: {
				            required: "Es necesario un tipo de industria valido.",
				            digits: "Es necesario un tipo de industria valido."
				        },
				        //Razón social
				        zamba_index_1188: {
				            required: "Es necesario una raz&oacute;n social.",
				            maxlength: "Se ha exedido el l&iacute;mite de 150 caracteres."
				        },
				        //Fecha alta
				        zamba_index_1214: {
				            maxlength: "Se ha exedido el l&iacute;mite de 10 caracteres.",
				            date: "Debe ingresar una fecha."
				        },
				        //Fecha baja
				        zamba_index_1215: {
				            maxlength: "Se ha exedido el l&iacute;mite de 10 caracteres.",
				            date: "Debe ingresar una fecha."
				        },
						//Tipo de actividad
				        zamba_index_1189: {
				            required: "Es necesario un tipo de actividad valido.",
				            digits: "Es necesario un tipo de actividad valido."
				        },
				        //Cod.Tipo de actividad
				        zamba_index_1223: {
				            required: "Es necesario un tipo de actividad valido.",
				            digits: "Es necesario un tipo de actividad valido."
				        },
				        //CIC
				        zamba_index_1220: {
				            maxlength: "Se ha exedido el l&iacute;mite de 10 caracteres.",
				            required: "Es necesario un CIC.",
				            digits: "Es necesario un CIC."
				        }
				    }
				}
				);
        }

        function ajustarselects() {
            if ($.browser !=undefined && $.browser.msie) {
                $('select').each(function() {
                    if ($(this).attr('multiple') == false) {
                        $(this).mousedown(function() {
                            if ($(this).css("width") != "auto") {
                                var width = $(this).width();
                                $(this).data("origWidth", $(this).css("width")).css("width", "auto");

                                // If the width is now less than before then undo 
                                if ($(this).width() < width) {
                                    $(this).unbind('mousedown');
                                    $(this).css("width", $(this).data("origWidth"));
                                }
                            }
                        })

                        // Handle blur if the user does not change the value 
                .blur(function() {
                    $(this).css("width", $(this).data("origWidth"));
                })

                        // Handle change of the user does change the value 
                .change(function() {
                    $(this).css("width", $(this).data("origWidth"));
                });
                    }
                });
            }
        }

		//Función que evalua si hacer requerido o no un control en base a uno o dos valores
        function ConditionalRequire(ObjSource, ObjDestiny, Value, Value2) {
			if ($("#" + ObjSource).val() == Value || (Value2 != undefined && $("#" + ObjSource).val() == Value2)) {
				$("#" + ObjDestiny).valid();
				$("#lbl_" + ObjDestiny).show();
				$("#" + ObjDestiny).rules('add', 'required');
				$("#" + ObjDestiny).removeClass("disabled");
			}
			else {
				//$("#" + ObjDestiny).removeClass("required");
			    $("#" + ObjDestiny).addClass("disabled");
				$("#" + ObjDestiny).rules('remove', 'required');

				$("#" + ObjDestiny).valid();
				$("#lbl_" + ObjDestiny).hide();
			}
		}
		
        $(document).ready(function() {

            ajustarselects();
            makeCalendar('zamba_index_1214');
            makeCalendar('zamba_index_1215');
            makerequired();
            AssociateIndexs("zamba_index_1189", "zamba_index_1223");
            AssociateIndexs("zamba_index_1223", "zamba_index_1189");
            MakeCalendarAfterValue('zamba_index_1214', 'zamba_index_1215');
            
			$("#ctl00_ContentPlaceHolder_InsertControl_btn_insertar").click(function() {
               ShowLoadingAnimation();
            });
			
			$("#ctl00_ContentPlaceHolder_InsertControl_btn_insertar").attr('value','Siguiente');

            //Agregado 15-11-2011
            GetCurrentDate();
            SelectActiveState();
			
			$("#zamba_index_1220").change(function(){
				ConditionalRequire("zamba_index_1220","zamba_index_1223","01", " ");
				ConditionalRequire("zamba_index_1220","zamba_index_1189","01", " ");
			});
        });

        function ValidacionPersonalizada(evt) {
            var isValid = true;
            //Recorro elementos del fieldset validando si se completaron
            $('.GeneralFormControl').each(function(i, item) {
                if (!$(item).valid()) {
                    isValid = false;
                }
            });


            if (!isValid) {
                evt.preventDefault();
            }
            else {
                $('#TAB').tabber.tabShow(1);
            }
        }

		var itemToScroll = null;
		function ValidateBeforeSave() {
		    
            var isValid = true;
            var tabIndex = 0;
			
            //Recorro elementos del fieldset validando si se completaron
            $('.GeneralFormControl').each(function(i, item) {
                if (!$(item).valid()) {
                    isValid = false;
					if(itemToScroll === null)
						itemToScroll = $(item);
                }
            });     

			if(itemToScroll != null){
				$.scrollTo(itemToScroll,600);
				setTimeout("itemToScroll.focus();itemToScroll=null;",600);
			}

            if (!isValid) {
                $('#TAB').tabber.tabShow(tabIndex);
				setTimeout("parent.hideLoading();", 1000);
            }
            else {
                ConvertToUpperForm();
                __doPostBack('ctl00$ContentPlaceHolder$InsertControl$btn_insertar', '');
            }
        }

        //Funciones agregadas 15-11-211

        function GetCurrentDate() {
			var myDate = new Date();
			var d = myDate.getDate() + '/' + (myDate.getMonth() + 1) + '/' + myDate.getFullYear();
			//Asignamos a fecha de alta el valor actual
			$("#zamba_index_1214").val(d);
        }

        function SelectActiveState() {
            var option = $("#zamba_index_1211").find("option[value='Activa']");
            if (option != null)
                option.attr("selected", "selected");
        }


        //Funciones agregadas 23-11-2011
        
        function ConvertToUpperForm() {
            $('.ConvertToUpper').each(function(i, item) {
                var cadena = $(item).val();
                cadena = cadena.toUpperCase();
                $(item).val(cadena);
            });
        }
 
        
    </script>

    <style type="text/css">
        .style1
        {
            width: 119px;
        }
        .style2
        {
            width: 178px;
        }
    </style>
</head>
<body>
    <div id="container">
        <form id="frmMain" name="frmMain" method="post" action="" style="width: 800px; height: 400px">
        <input id="hdnRuleId" type="hidden" />
        <input id="hdnAsocId" type="hidden" />
        <div id="dynamic_filter">
        </div>
        <div name="design" id="design">
            <strong>Industria<br/>Datos Generales</strong>
        </div>
        
            <div id="TAB" class="tabber" style="">
                <div class="tabbertab" id="General">
                    <h2>
                        Inf. General
                    </h2>
                    <fieldset class="GroupIngGen">
                        <p>
                            <table cellpadding="4">
                                <tr>
                                    <td class="style2">
                                        <label style="color: Red">
                                            *
                                        </label>
                                        <label>
                                            CIC:</label>
                                    </td>
                                    <td>
                                        <select id="zamba_index_1220" name="zamba_index_1220" style="width: 175px" class="required GeneralFormControl">
                                        </select>
                                    </td>
                                    <td class="style1">
                                        <label>
                                            Fecha de alta:
                                        </label>
                                    </td>
                                    <td>
                                        <input id="zamba_index_1214" name="zamba_index_1214" size="28" readonly="readonly"
                                            onchange="$(this).valid(); MakeCalendarAfterValue('zamba_index_1214', 'zamba_index_1215');" />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="style2">
                                        <label>
                                            Convenio:</label>
                                    </td>
                                    <td>
                                        <input id="zamba_index_1271" name="zamba_index_1271" style="width: 184px" maxlength="50"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="style2">
                                        <label>
                                            Segmentacion:
                                        </label>
                                    </td>
                                    <td>
                                        <input type="text" name="zamba_index_1218" style="background: gray;" readonly="true"
                                            disabled="disabled" size="50" />
                                    </td>
                                    <td class="style1">
                                        <label>
                                            Estado:
                                        </label>
                                    </td>
                                    <td>
                                        <select id="zamba_index_1211" name="zamba_index_1211" style="width: 175px;">
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="style2">
                                        <label style="color: Red">
                                            *
                                        </label>
                                        <label>
                                            Raz&oacuten Social:</label>
                                    </td>
                                    <td>
                                        <input type="text" id="zamba_index_1188" name="zamba_index_1188" size="50" length="150" class="required GeneralFormControl ConvertToUpper length"
                                            />
                                    </td>
                                    <td class="style1">
                                        <label>
                                            Codificacion de la industria:</label>
                                    </td>
                                    <td>
                                        <input id="zamba_index_1187" name="zamba_index_1187" style="background: gray;" readonly="true"
                                            size="28" />
                                    </td>
                                </tr>
                            </table>
                            <table cellpadding="4" width="100%">
                                <tr>
                                    <td style="padding: 10px 0 10px 0" colspan="6">
                                        <hr>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <font face="Tahoma" size="2"><u>Actividad</u></font>
                                    </td>
                                </tr>
                            </table>
                            <table cellpadding="4">
                                <tr>
                                    <td>
                                        <label style="color: Red">
                                            *
                                        </label>
                                        <label>
                                            Tipo de Industria:</label>
                                    </td>
                                    <td>
                                        <select id="zamba_index_1185" name="zamba_index_1185" style="width: 365px" class="GeneralFormControl">
                                        </select>
                                    </td>
                                    <td>
                                        <label style="color: Red; display:none">
                                            *
                                        </label>
                                        <label>
                                            Actividad no Regulada:
                                        </label>
                                    </td>
                                    <td>
                                        <input id="zamba_index_300005" name="zamba_index_300005" type="text" style="width: 165px;" class="GeneralFormControl"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label style="color: Red" id="lbl_zamba_index_1223">
                                            *
                                        </label>
                                        <label>
                                            Tipo de Actividad:</label>
                                    </td>
                                    <td>
                                        <select id="zamba_index_1223" name="zamba_index_1223" style="width: 365px;" class="GeneralFormControl">
                                        </select>
                                    </td>
                                    <td>
                                        <label style="color: Red" id="lbl_zamba_index_1189">
                                            *
                                        </label>
                                        <label>
                                            Cod. tipo Actividad:
                                        </label>
                                    </td>
                                    <td>
                                        <select id="zamba_index_1189" name="zamba_index_1189" style="width: 165px;" class="GeneralFormControl">
                                        </select>&nbsp;
                                    </td>
                                </tr>
                            </table>
                            
                        </p>
                    </fieldset>
                </div>
                             <div style="text-align: center">
        <input type="submit" class="submit" name="zamba_save" id="zamba_save" value="GUARDAR" />
        <input type="submit" class="submit" name="zamba_cancel" id="zamba_cancel" value="CANCELAR" />
    </div>
            </div>
        </form>
    </div>
</body>
</html>
